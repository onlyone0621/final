<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layouts/mainLayout">
<head>
<meta charset="UTF-8">
<title>ë©¤ë²„ ê´€ë¦¬</title>
<style>
.container {
	display: flex;
	min-height: 100vh;
}

.sidebar {
	width: 220px;
	background-color: #fbf9fd;
	padding: 20px;
	border-right: 1px solid #ddd;
}

.sidebar h4 {
	font-size: 18px;
	margin-bottom: 10px;
}

.sidebar ul {
	list-style: none;
	padding-left: 0;
	font-size: 14px;
}

.sidebar ul li {
	margin-bottom: 8px;
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.sidebar ul li a {
	text-decoration: none;
	color: #6a1b9a;
	font-weight: bold;
}

.settings-btn {
	font-size: 16px;
	color: #999;
	margin-left: 5px;
	text-decoration: none;
}

.add-board {
	display: block;
	margin-top: 10px;
	font-size: 14px;
	color: #d81b60;
	font-weight: bold;
	text-decoration: none;
}

.main {
	flex-grow: 1;
	padding: 20px;
}

.tabs {
	border-bottom: 1px solid #ddd;
	margin-bottom: 20px;
}

.tab {
	display: inline-block;
	margin-right: 15px;
	padding-bottom: 5px;
	font-weight: bold;
	color: #666;
	text-decoration: none;
	border-bottom: 2px solid transparent;
}

.tab.active {
	color: #d81b60;
	border-bottom: 2px solid #d81b60;
}

.status-switch {
	margin-bottom: 10px;
	font-size: 14px;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-top: 10px;
}

th, td {
	border: 1px solid #ddd;
	padding: 6px;
	text-align: center;
	font-size: 14px;
}

th {
	background: #f3e5f5;
}

.btn {
	padding: 5px 10px;
	margin: 5px 2px;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	font-size: 13px;
}

.btn-approve {
	background-color: #c5e1a5;
}

.btn-reject {
	background-color: #ef9a9a;
}

.btn-remove {
	background-color: #b0bec5;
}
</style>

<script>
	/**
	 * checkAll(mainCheck)
	 * - ë©”ì¸ ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ëª¨ë“  ë©¤ë²„ ì²´í¬ë°•ìŠ¤ë¥¼ ë©”ì¸ ì²´í¬ ìƒíƒœì™€ ê°™ê²Œ ë§ì¶¤
	 */
	function checkAll(mainCheck) {
		var checkboxes = document.querySelectorAll('.memberCheck');
		for (var i = 0; i < checkboxes.length; i++) {
			checkboxes[i].checked = mainCheck.checked;
		}
	}

	/**
	 * memberAction(action)
	 * - ìŠ¹ì¸ / ê±°ì ˆ / íƒˆí‡´ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë¨
	 * - ì„ íƒëœ ë©¤ë²„ë“¤ë§ˆë‹¤ formì„ ë§Œë“¤ì–´ POST ìš”ì²­ì„ ë³´ëƒ„
	 * - action: 'approve', 'reject', 'remove' ê°’ ì¤‘ í•˜ë‚˜
	 */
	function memberAction(action) {
		var checkboxes = document.querySelectorAll('.memberCheck');
		var selected = [];

		// ì„ íƒëœ ë©¤ë²„ë§Œ ë°°ì—´ì— ë‹´ê¸°
		for (var i = 0; i < checkboxes.length; i++) {
			if (checkboxes[i].checked) {
				selected.push(checkboxes[i]);
			}
		}

		// ì„ íƒëœ ë©¤ë²„ ì—†ìœ¼ë©´ ê²½ê³ 
		if (selected.length === 0) {
			alert('ì„ íƒëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.');
			return;
		}

		// actionì— ë”°ë¼ ì•ˆë‚´ ë©”ì‹œì§€ ìƒì„±
		var msg = '';
		if (action === 'approve') {
			msg = 'ì„ íƒí•˜ì‹  íšŒì›ì˜ ê°€ì…ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì´ ' + selected.length + 'ëª…)';
		} else if (action === 'reject') {
			msg = 'ì„ íƒí•˜ì‹  íšŒì›ì˜ ê°€ì…ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì´ ' + selected.length + 'ëª…)';
		} else if (action === 'remove') {
			msg = 'ì„ íƒí•˜ì‹  íšŒì›ì„ íƒˆí‡´ì‹œí‚¤ê² ìŠµë‹ˆê¹Œ?\n(ì´ ' + selected.length + 'ëª…)';
		}

		// ì‚¬ìš©ì í™•ì¸ (í™•ì¸ ëˆ„ë¥´ë©´ ì§„í–‰, ì·¨ì†Œ ëˆ„ë¥´ë©´ ì¢…ë£Œ)
		if (!confirm(msg)) {
			return;
		}

		// URL ê²½ë¡œ (query string ì œê±°)
		var basePath = location.pathname.split('?')[0];
		// ì˜ˆ: /community/1/member

		// ì„ íƒëœ ë©¤ë²„ë§ˆë‹¤ form ìƒì„± â†’ POST ì „ì†¡
		for (var j = 0; j < selected.length; j++) {
			var form = document.createElement('form');
			form.method = 'post';
			form.action = basePath + '/' + selected[j].value + '/' + action;
			// ì˜ˆ: /community/1/member/55/approve

			// formì„ bodyì— ë¶™ì´ê³  ë°”ë¡œ submit
			document.body.appendChild(form);

			// ë””ë²„ê·¸ìš©: ê²½ë¡œ ì¶œë ¥
			console.log('ğŸ‘‰ form action = ' + form.action);

			// ì „ì†¡
			form.submit();
		}
	}
</script>


</head>
<body>
	<div layout:fragment="content">
		<div class="container">

			<div class="sidebar">
				<h4 th:text="${communityInfo.name} ?: 'ì»¤ë®¤ë‹ˆí‹°'">ì»¤ë®¤ë‹ˆí‹°</h4>
				<ul th:if="${#lists.isEmpty(sidebarBoardList)}">
					<li>ê²Œì‹œíŒì´ ì—†ìŠµë‹ˆë‹¤.</li>
				</ul>
				<ul th:each="bdto : ${sidebarBoardList}">
					<li><a
						th:href="@{/community/{cId}/board/{boardId}(cId=${cId}, boardId=${bdto.id})}">
							[[${bdto.name}]] </a> <a
						th:href="@{/community/{cId}/board/{boardId}/update(cId=${cId}, boardId=${bdto.id})}"
						class="settings-btn">âš™</a></li>
				</ul>
				<a class="add-board"
					th:href="@{/community/{cId}/board/create(cId=${cId})}">+ ê²Œì‹œíŒ ì¶”ê°€</a>
			</div>


			<!-- ---------------------------------------------------------------------- -->

			<div class="main">
				<div class="tabs">
					<a class="tab" th:href="@{/community/{cId}/update(cId=${cId})}">ì •ë³´</a>
					<a class="tab"
						th:href="@{/community/{cId}/boardDelete(cId=${cId})}">ê²Œì‹œíŒ</a> <a
						class="tab active"
						th:href="@{/community/{cId}/member(cId=${cId})}">ë©¤ë²„</a> <a
						class="tab" th:href="@{/community/{cId}/close(cId=${cId})}">íì‡„</a>
				</div>

				<div class="status-switch">
					<!--  íƒˆí‡´ -->
					<label> <input type="radio" name="status"
						th:checked="${status == 'active'}"
						onclick="location.href='?status=active'"> ê°€ì…ë©¤ë²„
					</label> <label> <!--  ìŠ¹ì¸/ê±°ì ˆ --> <input type="radio" name="status"
						th:checked="${status == 'pending'}"
						onclick="location.href='?status=pending'"> ê°€ì… ìŠ¹ì¸ ëŒ€ê¸°
					</label>
				</div>

				<div>
					<button th:if="${status == 'active'}" class="btn btn-remove"
						onclick="memberAction('remove')">íƒˆí‡´</button>
					<span th:if="${status == 'active' and #lists.isEmpty(members)}">ìš´ì˜ìëŠ”
						íƒˆí‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span> <span
						th:if="${status == 'pending' and #lists.isEmpty(members)}">ìŠ¹ì¸
						ëŒ€ê¸°ì¤‘ì¸ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
					<div th:if="${status == 'pending' and !#lists.isEmpty(members)}">
						<button class="btn btn-approve" onclick="memberAction('approve')">ìŠ¹ì¸</button>
						<button class="btn btn-reject" onclick="memberAction('reject')">ê±°ì ˆ</button>
					</div>
				</div>

				<table>
					<thead>
						<tr>
							<th><input type="checkbox" onclick="checkAll(this)"></th>
							<th>ì´ë¦„</th>
							<th>ì†Œì†</th>
							<th>ì´ë©”ì¼</th>
							<th>ê°€ì…ì¼</th>
							<th>ê²Œì‹œê¸€</th>
						</tr>
					</thead>

					<tbody>
						<tr th:each="m : ${members}">
							<td><input type="checkbox" class="memberCheck"
								th:if="${m['ROLE'] != 'master'}" th:value="${m['ID']}">
								<span th:if="${m['ROLE'] == 'master'}">ğŸ‘‘</span></td>
							<td th:text="${m['NAME']} ?: 'N/A'">N/A</td>
							<td th:text="${m['DEPT_NAME']} ?: 'N/A'">N/A</td>
							<td th:text="${m['EMAIL']} ?: 'N/A'">N/A</td>
							<td
								th:text="${#dates.format(m['JOIN_DATE'], 'yyyy-MM-dd')} ?: 'N/A'">N/A</td>
							<td th:text="${m['POST_COUNT'] ?: 0}">0</td>

						</tr>
						<tr th:if="${#lists.isEmpty(members)}">
							<td colspan="6">ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
						</tr>
					</tbody>
				</table>

			</div>
		</div>
	</div>

</body>
</html>
