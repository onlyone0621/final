<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layouts/mainLayout">
<head>

<script>
function showAddGroupInput() {
    document.getElementById('addGroupForm').style.display = 'block';
    document.getElementById('groupNameInput').focus();
}
function hideAddGroupInput() {
    document.getElementById('addGroupForm').style.display = 'none';
    document.getElementById('groupNameInput').value = '';
}
function validateGroupInput() {
    var input = document.getElementById('groupNameInput').value.trim();
    if(input === "") {
        alert("그룹명을 입력하세요.");
        return false;
    }
    return true;
}

function addGroupFetch() {
    const groupName = document.getElementById('groupNameInput').value.trim();
    if (!groupName) {
        alert("그룹명을 입력하세요.");
        return;
    }

    fetch('/addr/addGroup', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ groupName: groupName })
    })
    .then(response => res => res.json())
    .then(data => {
        const groupList = document.querySelector('.sidebar-group-list');
        const newDiv = document.createElement('div');
        newDiv.textContent = groupName;
        groupList.appendChild(newDiv);

        hideAddGroupInput();
    });
}

function toggleQuickForm() {
    const form = document.getElementById('quickForm');
    form.style.display = (form.style.display === 'none' || form.style.display === '') ? 'block' : 'none';
}
function submitQuickForm() {
    alert('등록되었습니다!');
    // 폼 리셋 및 숨김 처리
    document.getElementById('quickForm').style.display = 'none';
    return false; // 실제 등록 로직에 따라 return 값 조정
}

</script>
<meta charset="UTF-8">
<title>주소록 관리</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    .sidebar-section-title {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
    }
    .sidebar-section-title i {
        font-size: 1rem;
        margin-left: 4px;
        color: #aaa;
        cursor: pointer;
    }
    .sidebar-link {
        color: #222 !important;
        text-decoration: none;
        font-weight: 500;
        margin-bottom: 0.25rem;
        display: inline-block;
        font-size: 0.95rem;
    }
    .sidebar-group-list {
        margin-left: 1.2rem;
        margin-bottom: 0.5rem;
    }
    .sidebar-add-btn {
        color: #222 !important;
        cursor: pointer;
        font-size: 0.95rem;
        margin-top: 0.5rem;
        display: inline-block;
        font-weight: 500;
    }
    .sidebar-contact-count {
        color: #0096e2;
        font-weight: bold;
        margin-left: 0.5rem;
        font-size: 0.95rem;
    }
    .sidebar-group-name {
        font-size: 0.97rem;
        margin-bottom: 0.2rem;
    }
    .sidebar-section {
        margin-bottom: 2rem;
    }
    .sidebar-divider {
        border-top: 1px solid #eee;
        margin: 1.5rem 0 1rem 0;
    }
    .sidebar-disabled-input {
        background: #f3f3f3;
        border: 1px solid #e0e0e0;
        color: #aaa;
        font-size: 0.95rem;
        padding: 2px 8px;
        border-radius: 4px;
        margin-bottom: 0.5rem;
        width: 90%;
    }
</style>
</head>
<body>
<div layout:fragment="content">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-2 d-none d-md-block bg-light sidebar" style="min-height:100vh;">
                <div class="sidebar-sticky pt-4">
                    <!-- 개인 주소록 -->
                    <div class="sidebar-section">
                    <button class="btn btn-outline-primary w-100 mb-3" onclick="location.href='/goInsertPage'">
					    연락처 추가
					</button>
                        <div class="sidebar-section-title">
                            <span data-bs-toggle="collapse" href="#personalCollapse" role="button" aria-expanded="true" aria-controls="personalCollapse" style="cursor:pointer;">
                                개인 주소록
                            </span>
                            <i class="bi bi-gear ms-auto"></i>
                        </div>
                        <div class="collapse show" id="personalCollapse">
                            <a href="addrMain" class="sidebar-link">전체 주소록</a>
                            
                            <div class="sidebar-group-list">
                                <!-- 그룹명 반복 출력 -->
                                
								    <div th:each="group : ${personalLists}">
								        <a th:href="@{'/groupAddrList/' + ${group.name}}" th:text="${group.name}" style="text-decoration:none; color:black;"></a>
								        <span class="sidebar-contact-count" th:text="${groupUserCountMap[group.name]}">0</span>
								    </div>
                            </div>
                            <div class="sidebar-group-list">
                            </div>
                            <div id="addGroupForm" style="display:none;">
							    <input type="text" class="form-control form-control-sm" name = "groupName" id="groupNameInput" placeholder="그룹명을 입력하세요">
							    <button type="button" class="btn btn-primary btn-sm mt-2" onclick="addGroupFetch()">확인</button>
							    <button type="button" class="btn btn-secondary btn-sm mt-2" onclick="hideAddGroupInput()">취소</button>
							</div>
                            <div class="sidebar-add-btn" onclick="showAddGroupInput()">+ 개인 주소록 추가</div>
                            
                            
                        </div>
                    </div>
                    <div class="sidebar-divider"></div>
                    <!-- 부서 주소록 -->
                    <div class="sidebar-section">
                        <div class="sidebar-section-title">
                            <span data-bs-toggle="collapse" href="#deptCollapse" role="button" aria-expanded="true" aria-controls="deptCollapse" style="cursor:pointer;">
                                부서 주소록
                            </span>
                        </div>
                        <div class="collapse show" id="deptCollapse">
                        <div class="sidebar-group-name" th:text="${dept}"></div>
                            <div class="sidebar-group-list">
                                <!-- 부서 그룹 반복 -->
                                    <a href="/deptAddr" class="sidebar-link" style="display:inline-block;">전체 주소록</a>
                                	<div th:each="dept : ${deptLists}">
                                            <span th:text="${dept.name}">안녕</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
<div class="col-md-10">
  <div class="container py-4">
    <h3>연락처 추가</h3>
    <form th:action="@{/insertAddr}" method="post" style="max-width:500px;">
  
      <div class="mb-3">
        <label for="name" class="form-label">이름</label>
        <input type="text" class="form-control" id="name" name="name" required>
      </div>
      <div class="mb-3">
        <label for="nickname" class="form-label">이름(표시명)</label>
        <input type="text" class="form-control" id="nickname" name="nickname" required>
      </div>
      <div class="mb-3">
        <label for="company" class="form-label">회사</label>
        <input type="text" class="form-control" id="company" name="company">
      </div>
      <div class="mb-3">
        <label for="department" class="form-label">부서</label>
        <input type="text" class="form-control" id="dept" name="dept">
      </div>
      <div class="mb-3">
        <label for="position" class="form-label">직위</label>
        <input type="text" class="form-control" id="grade" name="grade">
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">이메일</label>
        <input type="email" class="form-control" id="email" name="email">
      </div>
      <div class="mb-3">
        <label for="mobile" class="form-label">휴대폰</label>
        <input type="text" class="form-control" id="tel" name="tel">
      </div>
      <div class="mb-3">
        <label for="phone" class="form-label">유선전화</label>
        <input type="text" class="form-control" id="companytel" name="companytel">
      </div>
      <div class="mb-3">
        <label for="memo" class="form-label">메모</label>
        <input type="text" class="form-control" id="description" name="description">
      </div>
<!--       <div class="mb-3">
        <label for="groupSelect" class="form-label">연락처 그룹</label>
        <select class="form-select" id="groupSelect" name="groupSelect">
          <option value="">기본 연락처 선택</option>
          <option th:each="group : ${personalLists}" th:value="${group.name}" th:text="${group.name}"></option>
        </select>
      </div> -->
      <div class="mb-3 text-end">
        <button type="reset" class="btn btn-secondary">재입력</button>
        <button type="submit" class="btn btn-primary">등록</button>
        <button type="button" class="btn btn-outline-secondary" onclick="history.back()">취소</button>
      </div>
    </form>
  </div>
</div>

            </div>
        </div>
    </div>



</body>
</html>
